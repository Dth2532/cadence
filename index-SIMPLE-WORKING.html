<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Know Your Habits to Know Yourself">
  <meta name="theme-color" content="#667eea">
  <title>Cadence</title>
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="icon-192.png">
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    body { margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; }
  </style>
</head>
<body>
  <div id="root"></div>
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('service-worker.js').catch(e => console.log('SW failed'));
    }
    // Provide fallback storage
    if (!window.storage) {
      window.storage = {
        async get(key) {
          const v = localStorage.getItem(key);
          return v ? { key, value: v } : null;
        },
        async set(key, value) {
          localStorage.setItem(key, value);
          return { key, value };
        }
      };
    }
  </script>
  <script type="text/babel">
    const { useState, useEffect } = React;
    
    function App() {
      const [tasks, setTasks] = useState([]);
      const [input, setInput] = useState('');
      const [loading, setLoading] = useState(true);
      const today = new Date().toISOString().split('T')[0];

      useEffect(() => {
        loadData();
      }, []);

      async function loadData() {
        try {
          const result = await window.storage.get(`tasks:${today}`);
          if (result) setTasks(JSON.parse(result.value));
        } catch (e) {
          console.log('Load failed:', e);
        }
        setLoading(false);
      }

      async function addTask() {
        if (!input.trim()) return;
        const newTask = { 
          id: Date.now(), 
          text: input, 
          time: new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' }) 
        };
        const updated = [...tasks, newTask];
        setTasks(updated);
        await window.storage.set(`tasks:${today}`, JSON.stringify(updated));
        setInput('');
      }

      async function deleteTask(id) {
        const updated = tasks.filter(t => t.id !== id);
        setTasks(updated);
        await window.storage.set(`tasks:${today}`, JSON.stringify(updated));
      }

      if (loading) {
        return <div style={{minHeight:'100vh',display:'flex',alignItems:'center',justifyContent:'center',background:'linear-gradient(135deg, #667eea 0%, #764ba2 100%)'}}>
          <div style={{color:'white',fontSize:'18px'}}>Loading...</div>
        </div>;
      }

      return (
        <div style={{minHeight:'100vh',background:'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',padding:'20px'}}>
          <div style={{maxWidth:'800px',margin:'0 auto'}}>
            <div style={{background:'white',borderRadius:'12px',padding:'24px',marginBottom:'20px',boxShadow:'0 4px 20px rgba(0,0,0,0.1)'}}>
              <h1 style={{margin:'0 0 8px 0',fontSize:'32px',fontWeight:'700',color:'#111'}}>Cadence</h1>
              <p style={{margin:'0 0 20px 0',color:'#666',fontSize:'14px'}}>Know Your Habits to Know Yourself</p>
              <p style={{margin:'0',color:'#999',fontSize:'12px'}}>{new Date().toLocaleDateString('en-US', {weekday:'long',month:'short',day:'numeric',year:'numeric'})}</p>
            </div>

            <div style={{background:'white',borderRadius:'12px',padding:'24px',boxShadow:'0 4px 20px rgba(0,0,0,0.1)'}}>
              <h2 style={{margin:'0 0 20px 0',fontSize:'20px',fontWeight:'600'}}>Tasks Completed Today</h2>
              
              <div style={{display:'flex',gap:'12px',marginBottom:'24px'}}>
                <input
                  type="text"
                  value={input}
                  onChange={(e) => setInput(e.target.value)}
                  onKeyPress={(e) => e.key === 'Enter' && addTask()}
                  placeholder="What did you accomplish?"
                  style={{flex:1,padding:'12px',border:'1px solid #ddd',borderRadius:'8px',fontSize:'14px'}}
                />
                <button
                  onClick={addTask}
                  style={{background:'#667eea',color:'white',border:'none',padding:'12px 24px',borderRadius:'8px',fontSize:'14px',fontWeight:'600',cursor:'pointer'}}
                >
                  Add
                </button>
              </div>

              <div style={{display:'flex',flexDirection:'column',gap:'8px'}}>
                {tasks.length === 0 ? (
                  <p style={{textAlign:'center',color:'#999',padding:'40px 20px'}}>No tasks logged yet!</p>
                ) : (
                  tasks.map(task => (
                    <div key={task.id} style={{display:'flex',alignItems:'center',justifyContent:'space-between',padding:'12px',background:'#f9fafb',borderRadius:'8px',border:'1px solid #e5e7eb'}}>
                      <div style={{flex:1}}>
                        <div style={{fontSize:'14px',fontWeight:'500',color:'#111',marginBottom:'4px'}}>{task.text}</div>
                        <div style={{fontSize:'12px',color:'#999'}}>{task.time}</div>
                      </div>
                      <button onClick={() => deleteTask(task.id)} style={{background:'none',border:'none',cursor:'pointer',padding:'4px',color:'#999',fontSize:'18px'}}>×</button>
                    </div>
                  ))
                )}
              </div>
            </div>

            <div style={{marginTop:'20px',textAlign:'center',color:'white',fontSize:'12px',opacity:0.8}}>
              <p style={{margin:0}}>✨ Full features coming soon: Food Log, Sleep Tracking, Insights</p>
            </div>
          </div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
